# For more information on container definition files,
# visit https://sylabs.io/guides/3.7/user-guide/definition_files.html

Bootstrap: docker
# this basically provides pytorch and OS
From: nvcr.io/nvidia/pytorch:20.08-py3

%files
    # copy prediction script
    ./predict_simple.py /code/predict.py

    # Copy model files (including model weights etc.)
    # ...

    # and maybe other stuff
    ../requirements.txt /code/requirements.txt

%post
    # Install ubuntu packages
    apt update && apt upgrade -y
    # Install your python requirements
    pip install -r /code/requirements.txt

%runscript
    # At test time, container is run like this:
    # TODO insert final run command (singularity run ...)

    # run the inference script
    echo "Starting prediction..."
    python /code/predict.py "$@" -p /params

%labels
    # Please add these fields
    Author "Maximilian Zenk"
    Institution "German cancer research center (DKFZ)"
    Email "m.zenk@dkfz-heidelberg.de"

%help
    # optional
    This singularity container predicts segmentations on the images in the input folder (first argument)
    and saves them to the output folder (second argument). It uses thresholding as a dummy model.
